# Use the latest 2.1 version of CircleCI pipeline processing engine, see https://circleci.com/docs/2.0/configuration-reference/
version: 2.1

jobs:
  build:
    working_directory: /go/src/github.com/argoproj/argo-cd
    docker:
      - image: circleci/golang:1.12
      # - image: argoproj/argo-cd-ci-builder:v0.13.1
    steps:
      - checkout
      - run: dep ensure
      - run: make lint
      - run: git diff
      - run: make build
      - run: make test | go-junit-report > ${TEST_RESULTS}/go-test-report.xml
      # TODO - need tokens
      # - run: bash <(curl -s https://codecov.io/bash) -f coverage.out
      - save_cache:
          key: vendor
          paths:
            - vendor
      - store_artifacts:
          path: tests.xml
          destination: raw-test-output