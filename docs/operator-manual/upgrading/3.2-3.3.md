# v3.2 to 3.3

## Breaking Changes

### ApplicationSet CRD exceeds the size limit for client-side apply

In this version, the ApplicationSet CRD exceeds the size limit for client-side apply, meaning that the previous upgrade methods will result in `The CustomResourceDefinition "applicationsets.argoproj.io" is invalid: metadata.annotations: Too long: may not be more than 262144 bytes`

In order to avoid this issue, it is now required to upgrade Argo CD using Server Side Apply (SSA) along with `resolve conflicts`.
SSA does not store the ApplicationSet fields in `last-applied` annotation, thus not impacted by the annotation size limitation.
The `--force-conflicts` flag allows the apply operation to take ownership of fields that may have been previously managed by other tools (such as Helm or a previous `kubectl apply`). This is necessary for upgrades. Note that any custom modifications you've made to fields that are defined in the Argo CD manifests (like `affinity`, `env`, or `probes`) will be overwritten. However, fields not specified in the manifests (like `resources` limits/requests or `tolerations`) will be preserved.

#### Upgrading Argo CD which is managing itself 

When Argo CD is upgraded using an Argo CD Application, it is required to add 
``` yaml
    syncOptions:
    - ServerSideApply=true
```
to that Application. With this configuration, Argo CD will add the `resolve conflicts` option automatically.   

#### Upgrading Argo CD manually using Kustomize or plain manifests

When Argo CD is upgraded manually using plain manifests or Kustomize overlays, it is required to upgrade it with `--server-side --force-conflicts`. For example, `kubectl apply -n argocd --server-side --force-conflicts -f manifests/install.yaml`

#### Upgrading Argo CD manually using Helm

Users upgrading Argo CD manually using `helm upgrade` are not impacted by this change, since Helm does not use client-side apply and does not result in creation of the `last-applied` annotation. 

### Anonymous call to Settings API returns fewer fields

The Settings API now returns less information when accessed anonymously.
It no longer returns the `resourceOverrides` field which is considered sensitive information.

### New ENV Variable to control K8s Server Side Timeout of API Requests

The new environment variable `ARGOCD_K8S_SERVER_SIDE_TIMEOUT` can be used to control the K8s server side timeout of API requests.
In 3.2 and before this change, the K8s server side timeout was controlled by `ARGOCD_K8S_TCP_TIMEOUT` 
which is also used to control the TCP timeout when communicating with the K8s API server. 
From now onwards, the Kubernetes server-side timeout is controlled by a separate environment variable.

### Deprecated --self-heal-backoff-cooldown-seconds flag 

The `--self-heal-backoff-cooldown-seconds` flag of the `argocd-application-controller` has been deprecated and will be
removed in a future release.

## Helm Upgraded to 3.19.2

Argo CD v3.3 upgrades the bundled Helm version to 3.19.2. There are no breaking changes in Helm 3.19.2 according to the
[release notes](https://github.com/helm/helm/releases/tag/v3.19.0).

## Kustomize Upgraded to 5.8.0

Argo CD v3.3 upgrades the bundled Kustomize version from v5.7.0 to v5.8.0. According to the
[5.7.1](https://github.com/kubernetes-sigs/kustomize/releases/tag/kustomize%2Fv5.7.1)
and [5.8.0](https://github.com/kubernetes-sigs/kustomize/releases/tag/kustomize%2Fv5.8.0) release notes, there are no breaking changes.

However, note that Kustomize 5.7.1 introduces code to replace the `shlex` library used for parsing arguments in exec plugins.
If any existing manifests become corrupted, please follow the instructions in the
[5.7.1 release notes](https://github.com/kubernetes-sigs/kustomize/releases/tag/kustomize%2Fv5.7.1).

Kustomize 5.8.0 also resolves an issue where namespaces were not properly propagated to Helm charts.
If you rely on Helm charts within kustomization files, please review the details in the associated fix:
[kubernetes-sigs/kustomize#5940](https://github.com/kubernetes-sigs/kustomize/pull/5940).