# v3.2 to 3.3

## Breaking Changes

### Source Hydrator Now Tracks Hydration State Using Git Notes

Previously, Argo CD's Source Hydrator pushed a new hydrated commit for every DRY (source) commit, regardless of whether any manifest files (`manifest.yaml`) actually changed. This was necessary for the hydrator to track which DRY commit had last been hydrated: it embedded this information in the `hydrator.metadata` file's `drySha` field in each hydrated commit.

**Starting with v3.3, the Source Hydrator uses [git notes](https://git-scm.com/docs/git-notes) to record the state of the most recently hydrated DRY commit instead of creating a hydrated commit on every DRY commit.** The git note is stored in a dedicated namespace reserved for the Source Hydrator, making the state both reliable and isolated from other repository operations.

This design change improves repository cleanliness, reduces unnecessary commit noise, and lowers risk from excessive branch divergence due to frequent automated commits.

#### How It Works

- **On each hydration run:**
  1. The hydrator first pulls the existing git note in its namespace to check the last hydrated DRY commit SHA.
  2. If the note SHA matches the latest DRY SHA, the hydrator logs a debug message and skips hydration.
  3. If files such as `manifest.yaml` have *not* changed (even if DRY SHA is new), the hydrator skips committing manifests and only updates the git note to reflect the latest hydrated DRY SHA.
  4. If manifest files have changed, the hydrator commits the updated manifests and also updates the git note.

#### Migration Impact

- **Behavioral:**  
  - Users will no longer see a hydrated commit for every DRY commit. Only actual manifest changes will create a new commit; otherwise, the hydration state is tracked in the git note namespace.
- **Operational:**  
  - Applications and tools that depended on a hydrated commit for every DRY commit should now use the git note in the Source Hydrator namespace to determine the hydration state.
- **No action needed** for most users, but if you have automations dependent on hydrated commits as signals, please update them to consult the new git note.

#### Rationale and Benefits

- **Reduces repository clutter**: fewer unnecessary commits.
- **Improves performance** for teams with high-frequency DRY changes and rare manifest changes.
- **Decreases risk** of merge conflicts and branch bloat in automation scenarios.

## Removal of Application Path Cleaning During Hydration

- **Behavioral Change:**  
  In Argo CD versions prior to v3.3, the Source Hydrator would automatically clean (delete all files in) the application's configured path before writing out new manifest files during each hydration run. Starting with v3.3, this cleaning logic has been removed. The hydrator will now only overwrite or create files that correspond to the current manifest output; any additional files or obsolete data in the application path will remain untouched unless explicitly overwritten.
- **Operational Impact:**  
  If your repository or automation relied on automatic cleanup of stale or obsolete files in application paths, you must now handle this cleanup manually. This change avoids the risk of accidental deletion of unrelated files (for instance, if application paths overlap with directories containing other assets or when applications are restructured).
- **Recommended Action:**  
  Review your automation workflows and repository maintenance scripts to ensure that old or unwanted files in application paths are cleaned up if necessary. Consider implementing a periodic manual or automated cleanup procedure if your use case requires it.
- For more details on current behavior, see the [Source Hydrator user guide](../../user-guide/source-hydrator.md).