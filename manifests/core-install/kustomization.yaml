apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- ../crds
- ../cluster-rbac/application-controller
- ../base/config
- ../base/application-controller
- ../base/applicationset-controller
- ../base/repo-server
- ../base/redis
images:
- name: quay.io/argoproj/argocd
  newName: quay.io/argoproj/argocd
  newTag: latest

replacements:
- source:
    fieldPath: metadata.name
    kind: Service
    name: argocd-redis
    version: v1
  targets:
  - fieldPaths:
    - spec.template.spec.containers.[name=argocd-repo-server].args.2
    options:
      delimiter: ':'
    select:
      kind: Deployment
      name: argocd-repo-server
