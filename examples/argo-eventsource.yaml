apiVersion: argoproj.io/v1alpha1
kind: EventSource
metadata:
  name: argocd-app-ev
  namespace: demo
spec:
  eventBusName: codefresh-eventbus
  generic:
    argocd:
      insecure: true
      url: "argocd-server.demo.svc:80"
      config: "{}"
      authSecret:
        name: ev-password
        key: token

---
apiVersion: argoproj.io/v1alpha1
kind: Sensor
metadata:
  labels:
    app.kubernetes.io/managed-by: cf
  name: argocd-events
  namespace: demo
spec:
  dependencies:
    - eventName: argocd
      eventSourceName: argocd-app-ev
      name: argocd
  eventBusName: codefresh-eventbus
  triggers:
    - retryStrategy:
        duration: 0
        steps: 3
      template:
        conditions: argocd
        http:
          headers:
            Content-Type: application/json
          method: POST
          payload:
            - dest: data
              src:
                dataKey: body
                dependencyName: argocd
          secureHeaders:
            - name: Authorization
              valueFrom:
                secretKeyRef:
                  key: token
                  name: codefresh-token
          url: http://local.codefresh.io/argo/api/events
        name: components
